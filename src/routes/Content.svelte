<script lang="ts">
	import { T, useLoader, useTask } from '@threlte/core';
	import {
		interactivity,
		HTML,
		ImageMaterial,
		Text3DGeometry,
		useCursor,
		Text,
		useSuspense
	} from '@threlte/extras';
	import { Spring } from 'svelte/motion';
	import { DoubleSide } from 'three';

	import EmailIcon from './Icons/EmailIcon.svelte';
	import IgIcon from './Icons/IgIcon.svelte';
	import BskyIcon from './Icons/BskyIcon.svelte';

	type Props = {
		autoRender?: boolean;
		cameraRef?: any;
	};

	let { autoRender = true, cameraRef }: Props = $props();

	let html = $state();
	let position = $state([-47, 15, 65]);
	let lookAtTarget = $state([-25, 9, 12]);
	let htmlMenuPos = $state([-27, 42.5]);
	let cameraLocked = $state(false);

	const scale = new Spring([2, 2, 2]);
	const cursor = useCursor('pointer');
	const suspend = useSuspense();

	interactivity();

	//  ðŸ¦•  ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦•   Run layout logic ðŸ’€= ðŸ’£ ðŸŒ 
	updatePosition();

	function updatePosition() {
		if (cameraLocked) {
			return;
		}

		const screenWidth = window.innerWidth;
		const screenHeight = window.innerHeight;

		if (screenWidth < 768) {
			position = [-43, 13, 65];
			lookAtTarget = [-20, 9, 12];
			htmlMenuPos = [-28.5, 43.5];
		} else if (screenWidth > 728) {
			position = [-45, 15, 60];
			htmlMenuPos = [-8, 40];
		}
	}

	window.addEventListener('resize', updatePosition);

	const animatePosition = (startPos, endPos, startLookAt, endLookAt, duration, callback) => {
		let startTime;
		let hasLoggedFrame = false;
		cameraLocked = true;

		function animate(time) {
			if (!startTime) {
				startTime = time;
			}

			const elapsed = time - startTime;
			const t = Math.min(elapsed / duration, 1);

			let newPos = [
				(1 - t) * startPos[0] + t * endPos[0],
				(1 - t) * startPos[1] + t * endPos[1],
				(1 - t) * startPos[2] + t * endPos[2]
			];

			let newLookAt = [
				(1 - t) * startLookAt[0] + t * endLookAt[0],
				(1 - t) * startLookAt[1] + t * endLookAt[1],
				(1 - t) * startLookAt[2] + t * endLookAt[2]
			];

			if (!hasLoggedFrame) {
				hasLoggedFrame = true;
			}

			cameraRef.position.set(...newPos);
			cameraRef.lookAt(...newLookAt);

			if (t < 1) {
				requestAnimationFrame(animate);
			} else {
				if (callback) callback();
			}
		}

		requestAnimationFrame(animate);
	};

	//  ðŸ¦•  ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦•  Extras/ Debug ðŸ’€= ðŸ’£ ðŸŒ 
</script>

// ðŸ¦• ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦• Selection Text ðŸ’€= ðŸ’£ ðŸŒ 
<HTML autoRender={true} class="menu" position={htmlHomeContext}>
	<article class="fade-in">
		{#if currentButton === 1}
			<p class="backer">
				Thank you for visiting, while this site is under construction, I hope you enjoy your visit.
			</p>
		{/if}
	</article>
</HTML>

// ðŸ¦• ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦• Contact / Social Icons ðŸ’€= ðŸ’£ ðŸŒ 
{#if currentContact === 0}
	<T.Mesh position={[-33, 11, 11]} scale={[0.005, 0.005, 0.005]} rotation={[-0.2, -0.65, -0.11]}>
		<Text3DGeometry text={'Contact'} />
		<T.MeshStandardMaterial color="black" />
	</T.Mesh>

	<T.Mesh position={[-33, 10, 11]} scale={[0.005, 0.005, 0.005]} rotation={[-0.2, -0.65, -0.11]}>
		<Text3DGeometry text={'US'} />
		<T.MeshStandardMaterial color="black" />
	</T.Mesh>

	<T.Mesh position={[-33, 9, 11]} scale={[0.005, 0.005, 0.005]} rotation={[-0.2, -0.65, -0.11]}>
		<Text3DGeometry text={'NOW!'} />
		<T.MeshStandardMaterial color="black" />
	</T.Mesh>
{/if}

<!-- IG icon  -->
<T.Mesh
	class="igIcon"
	onclick={() => {
		currentContact = 1;
	}}
	onpointerenter={cursor.onPointerEnter}
	onpointerleave={cursor.onPointerLeave}
>
	<IgIcon />
</T.Mesh>

<!-- BluSky icon  -->
<T.Mesh
	onclick={() => {
		currentContact = 2;
	}}
	onpointerenter={cursor.onPointerEnter}
	onpointerleave={cursor.onPointerLeave}
>
	<BskyIcon />
</T.Mesh>

<!-- Email  -->
<T.Mesh
	onclick={() => {
		currentContact = 3;
	}}
	onpointerenter={cursor.onPointerEnter}
	onpointerleave={cursor.onPointerLeave}
>
	<EmailIcon />
</T.Mesh>

{#if currentButton === 3}
	<!-- Instagram  -->
	{#if currentContact === 1}
		<T.Mesh position={[-33, 11, 11]} scale={[0.005, 0.005, 0.005]} rotation={[-0.2, -0.65, -0.11]}>
			<Text3DGeometry text={'Instagram'} />
			<T.MeshStandardMaterial color="white" />
		</T.Mesh>
		<T.Mesh position={[-32, 9, 11.8]} scale={[4.8, 2.75]} rotation={[0, -0.723, 0]}>
			<T.PlaneGeometry />
			<ImageMaterial transparent side={DoubleSide} url="uckzAlt.png" />
		</T.Mesh>
	{/if}

	<!-- BluSky  -->
	{#if currentContact === 2}
		<T.Mesh position={[-33, 11, 11]} scale={[0.005, 0.005, 0.005]} rotation={[-0.2, -0.65, -0.11]}>
			<Text3DGeometry text={'BlueSky'} />
			<T.MeshStandardMaterial color="blue" />
		</T.Mesh>
		<T.Mesh position={[-32, 9, 11.8]} scale={[4.8, 2.75]} rotation={[0, -0.723, 0]}>
			<T.PlaneGeometry />
			<ImageMaterial transparent side={DoubleSide} url="butterfittiAlt.png" />
		</T.Mesh>
	{/if}

	<!-- Email  -->
	{#if currentContact === 3}
		<T.Mesh position={[-28, 7.25, 8]} scale={[1, 1, 1]} rotation={[0, -0.65, 0]}>
			<HTML position.y={0} transform {autoRender}>
				<form class="contact">
					<p>Reach out</p>
					<br />
					<label for="full_name">Name</label><br />
					<input
						type="text"
						id="full_name"
						name="full_name"
						placeholder="Enter your name"
						required
					/><br />

					<label for="contact_point">Email</label><br />
					<input
						type="text"
						id="contact_point"
						name="contact_point"
						placeholder="Enter your email"
						required
					/><br />

					<label for="message">Message</label><br />
					<textarea id="message" name="message" placeholder="Enter your message" required
					></textarea>

					<button class="ripple-btn" type="submit">Submit</button>
				</form>
			</HTML>
		</T.Mesh>
	{/if}
{/if}

// ðŸ¦• ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦•Services ðŸ’€= ðŸ’£ ðŸŒ 
<HTML autoRender={false} position={htmlServiceContext} class="services">
	{#if currentButton === 2}
		<section>
			<div class="price-box backer">
				<h2>Pricing Tiers</h2>
				<p>
					Every project is unique, and pricing varies based on scope and complexity. My goal is to
					deliver exceptional results while keeping costs fair and equitable. All projects come with
					a free year of support to ensure your website stays up and running.
				</p>
				<button
					onclick={() => {
						handleClick([-20, 9.5, 14], [-27, 9.5, 0], () => loadNextSet('A'));
						currentButton = 6;
					}}
				>
					Learn about the steps involved in the process.
				</button>

				<h3>Simple</h3>
				<p>
					Perfect for those who know exactly what they need. You provide the vision, including the
					color scheme, features, and design preferences, and I bring it to life with a static or
					lightly functional website.
				</p>

				<h3>Moderate</h3>
				<p>
					Ideal if you have a general idea but need some guidance to shape your vision. Together,
					weâ€™ll refine your ideas into a cohesive, functional website. This is going to be more than
					just a static page.
				</p>

				<h3>"Iâ€™ll Handle It"</h3>
				<p>
					For when you have a jumble of brilliant ideas but need someone to make them happen. Weâ€™ll
					collaborate to turn your concepts into a polished, professional site. This can be complex
					and include E-commerce or CMS services.
				</p>
			</div>
		</section>
	{/if}

	{#if currentButton === 6}
		<article class="steps backer">
			<h2>How It Works</h2>
			<p>
				I follow a structured process to ensure your project is completed efficiently and to the
				highest standard. Here's what to expect:
			</p>
			<button
				onclick={() => {
					handleClick([-20, 9.5, 14], [-27, 9.5, 0], () => loadNextSet('A'));
					currentButton = 7;
				}}
			>
				Follow the steps
			</button>
		</article>
	{/if}
	{#if currentButton === 7}
		<article class="steps backer">
			<h2>Step 1</h2>
			<p>
				<strong>Planning:</strong> Weâ€™ll discuss your goals, brainstorm ideas, and create a clear plan
				for your website.
			</p>
			<button
				onclick={() => {
					handleClick([-19, 10.5, 14], [-25, 10.5, 0], () => loadNextSet('A'));
					currentButton = 8;
				}}
			>
				Next step
			</button>
		</article>
	{/if}
	{#if currentButton === 8}
		<article class="steps backer">
			<h2>Step 2</h2>
			<p>
				<strong>Design:</strong> Iâ€™ll craft a layout, color palette, and design that reflect your brand
				and message.
			</p>
			<button
				onclick={() => {
					handleClick([-19, 11.5, 14], [-25, 11.5, 0], () => loadNextSet('A'));
					currentButton = 9;
				}}
			>
				Next step
			</button>
		</article>
	{/if}
	{#if currentButton === 9}
		<article class="steps backer">
			<h2>Step 3</h2>
			<p>
				<strong>Development:</strong> Your website will be built from the ground up, tailored to your
				specifications.
			</p>

			<button
				onclick={() => {
					handleClick([-19, 13, 14], [-25, 13, 0], () => loadNextSet('A'));
					currentButton = 10;
				}}
			>
				Next step
			</button>
		</article>
	{/if}
	{#if currentButton === 10}
		<article class="steps backer">
			<h2>Step 4</h2>
			<p>
				<strong>Testing:</strong> Every detail will be tested across different devices and browsers to
				ensure it works seamlessly.
			</p>

			<button
				onclick={() => {
					handleClick([-19, 14.5, 14], [-25, 14.5, 0], () => loadNextSet('A'));
					currentButton = 11;
				}}
			>
				Next step
			</button>
		</article>
	{/if}

	{#if currentButton === 11}
		<article class="steps backer">
			<h2>Step 5</h2>
			<p>
				<strong>Deployment:</strong> Your website goes live and is ready to make an impact!
			</p>
			<button
				onclick={() => {
					handleClick([-19, 15.5, 14], [-25, 15.5, 0], () => loadNextSet('A'));
					currentButton = 12;
				}}
			>
				Next step
			</button>
		</article>
	{/if}
	{#if currentButton === 12}
		<article class="steps backer">
			<h2>Step 6</h2>
			<p>
				<strong>Support:</strong> Enjoy free support for the first year to address any unforeseen issues
				or updates.
			</p>
			<button
				onclick={() => {
					handleClick([-20, 18.5, 14], [-28.5, 16, 0], () => loadNextSet('A'));
					currentButton = 13;
				}}
			>
				Final step
			</button>
		</article>
	{/if}
	{#if currentButton === 13}
		<article class="steps backer">
			<h2>Step 7</h2>
			<p>
				<strong>Management:</strong> Take it further with advanced features like analytics, tracking,
				and audience engagement tools.
			</p>
		</article>
	{/if}
</HTML>

// ðŸ¦• ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦• AboutðŸ’€= ðŸ’£ ðŸŒ 
<HTML autoRender={false} class="menu" position={htmlAboutContext}>
	<article>
		{#if currentButton === 4}
			<p class="about-box backer">
				A few years ago, while working in retail, I started learning website development during
				downtime at the shop. I took on the challenge of building a new site for the store, and
				something just clicked. What began as a side project quickly became a genuine passion, and I
				found myself diving deeper into design, development, and everything in between.
				<br />
				<br />
				Since then, Iâ€™ve kept learning and building stuff, sometimes just for fun or sometimes for small
				businesses. Iâ€™ve realized I really enjoy helping others create a strong online presence. Now,
				Iâ€™m looking to work with individuals and businesses who need a website that not only looks good
				but actually works for them. If that sounds like something youâ€™re after, Iâ€™d love to chat.
			</p>
		{/if}
	</article>
</HTML>

<!-- ðŸ¦•  ðŸ¦–ðŸ¦–ðŸ¦– ðŸ¦• ðŸ¦• ProjectsðŸ’€= ðŸ’£ ðŸŒ  -->
<HTML autoRender={false} class="menu" position={htmlProjectContext}>
	<article>
		{#if currentButton === 5}
			<p class="backer">Projects: these are so cool</p>
		{/if}
	</article>
</HTML>
